<!DOCTYPE html>
<html>

<head>
	{% block head %}
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<meta name="description" content="">
	<meta name="author" content="">
	<title>Basic Social Media Site</title>
	<link rel="icon" href="{{url_for('static', filename='favicon.png')}}">
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
		integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
	<style>
		.col-lg-3 {
			border-radius: 50px;
			background: lightyellow;
			position: relative;
			overflow: hidden;
		}

		.jumbotron {
			border-radius: 25px;
			position: relative;
			overflow: hidden;
			< !-- background: #5C97FF;
			-->z-index: 999;
		}

		.jumbotron h1 {
			padding: 50px;
			padding-left: 20px;
			z-index: 2;
			position: relative;
			color: black;
		}

		.jumbotron:before {
			content: ' ';
			display: block;
			position: absolute;
			left: 0;
			top: 0;
			width: 100%;
			height: 100%;
			opacity: 0.6;
			background-image: url('https://storage.googleapis.com/basic-flask-bucket/profiles/{{data.banner_pic}}/banner_pic/{{data.banner_pic}}_banner_pic.png?{{random_num}}');
			background-repeat: no-repeat;
			background-position: 50% 50%;
			background-size: cover;
		}
	</style>
	{% endblock %}
</head>

<body onload="myFunction()">
	<div style="background:url('{{url_for('static',filename='wood.jfif')}}')">
		<div class="container" style="background-color:white; width:90%; max-width:1920px;height:auto;">
			<nav class="navbar navbar-expand-lg navbar-light bg-light">
				<a class="navbar-brand" href="" id="BSMS_nav">BSMS</a>
				<button class="navbar-toggler" type="button" data-toggle="collapse"
					data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
					aria-label="Toggle navigation">
					<span class="navbar-toggler-icon"></span>
				</button>
				<div class="collapse navbar-collapse" id="navbarSupportedContent">
					<ul class="navbar-nav mr-auto">
						<li class="nav-item active">
							<a class="nav-link" href="" id="home_nav">Home <span class="sr-only">(current)</span></a>
						</li>
						<li class="nav-item">
							<a class="nav-link" href="#">Link</a>
						</li>
						<li class="nav-item dropdown">
							<a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button"
								data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
								Account Options
							</a>
							<div class="dropdown-menu" aria-labelledby="navbarDropdown">
								<a class="dropdown-item" href="/logout">Log Out</a>
								<a class="dropdown-item" href="" id="edit_nav"> Edit Profile</a>
								<div class="dropdown-divider"></div>
								<a class="dropdown-item" href="#">Something else here</a>
							</div>
						</li>
						<li class="nav-item">
							<a class="nav-link disabled" href="#" tabindex="-1" aria-disabled="true">Disabled</a>
						</li>
					</ul>
					<ul class="navbar-nav" style="float:right; padding-right:5px;">
						<li class="nav-item dropdown">
							<a class="notification nav-link dropdown" id="navbarDropdown2" data-toggle="dropdown"
								aria-haspopup="true" aria-expanded="false">
								<img style="max-width: 40px; max-height: 40px;"
									src="{{url_for('static', filename='bell_icon.png')}}">
								{% if data.notifications|length > 0 %}
								<span class="badge">{{data.notifications|length}}</span>
								{% endif %}
							</a>
							<div class="dropdown-menu" aria-labelledby="navbarDropdown2">
								{% if data.notifications|length > 0 %}
								{% for item in data.notifications %}
								<a class="dropdown-item" href="/profile/{{item[2]}}">{{item[1]}} wants to be your
									friend!</a>
								{% endfor %}
								{% endif %}
								{% if data.notifications|length <= 0 %}
								<a class="dropdown-item" href="#"> No new notifications!</a>
								{% endif %}
							</div>
						</li>
					</ul>
					<div id="search_bar">
						<form class="form-line my-2 my-lg-0">
							<input class="form-control mr-sm-2" type="search" autocomplete="off" placeholder="Search"
								aria-label="Search" id="myInput">
							<!-- <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button> -->

							<div class="result rounded"
								style="z-index:999;position:absolute; background-color:white;border-color:gray;width:218px;border-style:solid;border-width:thin"
								id="results"></div>
						</form>
					</div>
				</div>
			</nav>
			{% block content %} {% endblock %}
</body>

<script>

	function myFunction() {
		dict = document.cookie
			.split(';')
			.reduce((res, c) => {
				const [key, val] = c.trim().split('=').map(decodeURIComponent)
				const allNumbers = str => /^\d+$/.test(str);
				try {
					return Object.assign(res, { [key]: allNumbers(val) ? val : JSON.parse(val) })
				} catch (e) {
					return Object.assign(res, { [key]: val })
				}
			}, {});
		session = document.cookie
		$("#edit_nav").attr("href", '/edit-profile/' + session);
		$("#home_nav").attr("href", '/profile/' + dict['email_address']);
		$("#BSMS_nav").attr("href", '/profile/' + dict['email_address']);

		var typingTimer;                //timer identifier
		var doneTypingInterval = 100;  //time in ms, 5 second for example

		//on keyup, start the countdown
		$('#myInput').on('keyup', function () {
			clearTimeout(typingTimer);
			typingTimer = setTimeout(doneTyping, doneTypingInterval);
		});

		//on keydown, clear the countdown
		$('#myInput').on('keydown', function () {
			clearTimeout(typingTimer);
		});

		//user is "finished typing," do something
		function doneTyping() {
			var input = $("#myInput").val();
			var resultDropdown = $(".result");
			var results = document.getElementById("results");
			results.borderStyle = "solid";

			if (input.length) {

				results.borderStyle = "solid";
				results.borderColor = "red";

				var resp_string = "";
				$.ajax({
					url: '/quickQuery',
					data: { 'input': $("#myInput").val() },
					type: 'POST',
					success: function (response) {
						var resp = JSON.parse(response)['data']
						for (index in resp) {
							resp_string = resp_string.concat("<a class=\"custom\" href=\"/profile/" + resp[index]['email_address'] + "\" style=\"padding-left:5px;padding-bottom:5px; color:black;text-decoration:none;\"> " + resp[index]['name'] + " </a><br>");
						}
						resultDropdown.html(resp_string)
					},
					error: function (error) {
						console.log(error);
					}
				});
			} else {
				resultDropdown.empty();
			}


		}
	}
</script>
<style>
	.custom:hover {
		background-color: lightblue;
	}

	.custom:active {
		background-color: lightgray;
	}

	.notification {
		/* background-color: #555; */
		color: white;
		text-decoration: none;
		padding: 0px 10px;
		position: relative;
		display: inline-block;
		/* border-radius: 2px; */
	}

	.notification:hover {
		background: lightblue;
	}

	.notification:active {
		background: lightgray;
	}

	.notification .badge {
		position: absolute;
		top: -3px;
		right: -3px;
		/* padding: 5px 10px; */
		border-radius: 50%;
		background: red;
		color: white;
	}
</style>


{% block scripts %} {% endblock %}
<script src="https://code.jquery.com/jquery-3.4.1.js" integrity="sha256-WpOohJOqMqqyKL9FccASB9O0KwACQJpFTUBLTYOVvVU="
	crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
	integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
	crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
	integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
	crossorigin="anonymous"></script>